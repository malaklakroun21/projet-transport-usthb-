{%extends 'main.html'%} {% load static %} {% block extra_css %}
<link rel="stylesheet" href="{% static 'css/clients.css' %}" />
{% endblock %} {%block content%}

<section class="clients-page">
  <!-- Page title + search -->
  <div class="clients-header">
    <h2>Gestion Client</h2>

    <div class="search-box">
      <i class="fa fa-search"></i>
      <form method="GET" action="">
        <input
          type="text"
          name="q"
          placeholder="Rechercher par nom, téléphone, adresse..."
          value="{{ query|default:'' }}"
        />
      </form>
    </div>
  </div>

  <!-- Actions bar -->
  <div class="clients-actions">
    <a href="{% url 'create-client' %}" class="btn primary">
      <i class="fa fa-plus"></i> Nouveau Client
    </a>

  <button class="btn" onclick="printClientsTable()">
  <i class="fa fa-print"></i> Imprimer la liste
</button>
<a href="{% url 'export-clients-csv' %}" class="btn">
  <i class="fa fa-file-export"></i> Exporter la liste
</a>

   <form method="GET" action="" class="filter-form">
  <select name="status" class="status-filter" onchange="this.form.submit()">
    <option value="ALL" {% if status == 'ALL' %}selected{% endif %}>Filtrer par statut : ALL</option>
    <option value="Actif" {% if status == 'Actif' %}selected{% endif %}>Actif</option>
    <option value="Inactif" {% if status == 'Inactif' %}selected{% endif %}>Inactif</option>
  </select>
  
  <!-- Keep the search query so filter + search work together -->
  <input type="hidden" name="q" value="{{ query|default:'' }}">
</form>
  </div>

  <!-- Table -->
  <div class="table-container">
    <table class="clients-table">
      <thead>
        <tr>
          <th>num</th>
          <th>Type</th>
          <th>Prénom</th>
          <th>Téléphone</th>
          <th>Email</th>
          <th>Solde</th>
          <th>Adresse</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {%for client in clients %}
        <tr>
          <td>{{ client.code_client }}</td>
          <td>{{ client.client_type }}</td>
          <td>{{ client.name }}</td>
          <td>{{ client.phone }}</td>
          <td>{{ client.email }}</td>
          <td>{{ client.balance }}</td>
          <td>{{ client.address }}</td>
          <td>
            <a
              href="{% url 'update-client' client.id %}"
              class="btn action-btn edit-btn"
            >
              <i class="fa fa-edit"></i>
            </a>
            <a
              href="{% url 'delete-client' client.id %}"
              class="btn action-btn delete-btn"
            >
              <i class="fa fa-trash"></i>
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
<script>
  const searchInput = document.querySelector(".search-box input");
  const tableRows = document.querySelectorAll(".clients-table tbody tr");

  searchInput.addEventListener("input", function () {
    const filter = this.value.toLowerCase();
    tableRows.forEach((row) => {
      const text = row.textContent.toLowerCase();
      row.style.display = text.includes(filter) ? "" : "none";
    });
  });
function printClientsTable() {
    // Select the table container
    var tableContainer = document.querySelector('.table-container');

    // Open a new window for printing
    var newWin = window.open('', '', 'width=900,height=700');
    
    // Add HTML and styling for print
    newWin.document.write('<html><head><title>Liste des clients</title>');
    newWin.document.write('<style>');
    newWin.document.write('table { width: 100%; border-collapse: collapse; }');
    newWin.document.write('th, td { border: 1px solid #000; padding: 8px; text-align: left; }');
    newWin.document.write('th { background-color: #f1f3f5; }');
    newWin.document.write('h2 { text-align: center; }');
    newWin.document.write('</style></head><body>');
    newWin.document.write('<h2>Liste des clients</h2>');
    newWin.document.write(tableContainer.innerHTML);
    newWin.document.write('</body></html>');

    newWin.document.close();
    newWin.focus();
    newWin.print();
    newWin.close();
}


</script>
{%endblock%}
